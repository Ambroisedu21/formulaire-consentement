<script>
(function(){
  let hubspotLoaded = false;
  function loadHubSpot() {
    if (hubspotLoaded) return;
    hubspotLoaded = true;
    const s = document.createElement("script");
    s.async = true;
    s.defer = true;
    s.src = "https://js.hs-scripts.com/49153213.js";
    document.head.appendChild(s);
    console.log("âœ… HubSpot tracking chargÃ©");
  }

  // Si dÃ©jÃ  consenti avant
  const av = document.cookie
    .split('; ')
    .find(row => row.startsWith('axeptio_authorized_vendors='));
  if (av && av.split('=')[1].split(',').includes('hubspot')) {
    loadHubSpot();
  }

  // Quand Axeptio dit "j'ai acceptÃ© HubSpot"
  window.addEventListener("axeptio_activate_hubspot", () => {
    console.log("ðŸŽ‰ axeptio_activate_hubspot");
    // on Ã©crit le cookie pour Axeptio
    document.cookie = "axeptio_authorized_vendors=hubspot; Path=/; Max-Age="+(365*24*3600)+"; SameSite=None; Secure";
    document.cookie = "axeptio_cookies="+encodeURIComponent(JSON.stringify({hubspot:true}))+"; Path=/; Max-Age="+(365*24*3600)+"; SameSite=None; Secure";
    loadHubSpot();
  });

  // Soumission du formulaire
  document.getElementById('external-hubspot-form')
    .addEventListener('submit', function(e){
      e.preventDefault();
      const resp = document.getElementById('form-response');
      const data = { /* vos champsâ€¦ */ };
      fetch(`https://api.hsforms.com/â€¦`, {
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body: JSON.stringify(data)
      })
      .then(r => {
        if (r.ok) {
          resp.style.cssText = "display:block;color:green;margin-top:1em";
          resp.innerText = "Merci ! Formulaire soumis.";
        } else {
          return Promise.reject(r.statusText);
        }
      })
      .catch(err => {
        resp.style.cssText = "display:block;color:red;margin-top:1em";
        resp.innerText = "Une erreur est survenue.";
        console.error(err);
      });
    });
})();
</script>
