<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Formulaire de contact RGPD</title>
</head>
<body>
  <h1>Formulaire de contact</h1>

  <form id="contactForm">
    <label>Prénom : <input type="text" name="firstname" required /></label><br/>
    <label>Nom : <input type="text" name="lastname" required /></label><br/>
    <label>Email : <input type="email" name="email" required /></label><br/>

    <label>
      <input type="checkbox" id="consentCheckbox" required />
      En cliquant sur envoyer ci-dessous vous autorisez l'entreprise Ambroise Training à stocker et traiter les données personnelles soumises ci-dessus qu'elle vous fournisse le contenu demandé.
    </label><br/>

    <button type="submit">Envoyer</button>
  </form>

  <div id="result"></div>

  <script>
    document.getElementById("contactForm").addEventListener("submit", async function(e) {
      e.preventDefault();

      const consentGiven = document.getElementById("consentCheckbox").checked;
      if (!consentGiven) {
        alert("Veuillez accepter la mention de consentement.");
        return;
      }

      const portalId = "49153213";
      const formId = "1262a4d1-1496-4553-b70d-64bcle676047";
      const endpoint = `https://api.hsforms.com/submissions/v3/integration/submit/${portalId}/${formId}`;

      const form = e.target;
      const data = {
        fields: [
          { name: "firstname", value: form.firstname.value },
          { name: "lastname", value: form.lastname.value },
          { name: "email", value: form.email.value }
        ]
      };

      const response = await fetch(endpoint, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(data)
      });

      if (response.ok) {
        document.getElementById("result").textContent = "Merci pour votre envoi !";
        form.reset();
      } else {
        document.getElementById("result").textContent = "Erreur lors de l’envoi du formulaire.";
        console.error(await response.text());
      }
    });
  </script>
</body>
</html>
